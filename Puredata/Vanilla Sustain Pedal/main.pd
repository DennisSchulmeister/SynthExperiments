#N canvas 0 49 1920 1009 12;
#X obj -30 -30 preset_hub k12 1 %hidden%;
#X obj 500 130 notein 1;
#X floatatom 500 200 5 0 0 1 Voice - - 0 0 1, f 5;
#X floatatom 590 200 5 0 0 1 Note - - 0 0 1, f 5;
#X floatatom 670 200 5 0 0 1 Velocity - - 0 0 1, f 5;
#X obj 500 728 dac~;
#X obj 500 570 pack f f f;
#X obj 500 160 poly 16 1;
#X obj 500 670 clone -s 1 voice 16;
#X obj 500 700 *~ 0.2;
#X obj 1050 450 ctlin 64;
#X floatatom 1050 479 5 0 0 0 - - - 0 0 1, f 5;
#X text 1000 300 --- Sustain Pedal ---;
#X obj 1000 600 bag, f 22;
#X obj 1000 420 spigot;
#X obj 500 228 s \$0-voice;
#X obj 590 228 s \$0-note;
#X obj 670 228 s \$0-velocity;
#X text 500 100 --- Basic Voice Allocation with PD's [poly] ---;
#X obj 1040 360 r \$0-velocity;
#X obj 1000 330 r \$0-voice;
#X obj 1050 509 moses 1, f 15;
#X msg 1050 570 flush;
#X text 800 170 <--- Polyphony: 16;
#X text 640 670 <--- Polyphony: 16;
#X obj 540 360 r \$0-velocity;
#X obj 540 390 > 0;
#X obj 500 510 spigot;
#X obj 500 330 r \$0-voice;
#X obj 550 540 r \$0-note;
#X obj 630 540 r \$0-velocity;
#X msg 1000 631 \$1 0 0;
#X obj 540 480 ||;
#X obj 580 450 < 1;
#X obj 580 420 ctlin 64;
#X text 500 300 --- Note On/Off ---;
#X text 640 360 (note on);
#X text 720 420 (or sustain pedal not pressed);
#X text 1140 360 (note off);
#X text 800 130 <--- MIDI Input Channel;
#X text 10 10 More or less easy handling of a sustain pedal in PD Vanilla===========================================================
Note that this has some severe limitations due to the lack of functionality
in PD Vanilla's [poly] object: - No sustenuto pedal (to hold already
playing notes only) - No retriggering of notes (double notes are
played twice) - Stopping the wrong notes when polyphony is exceeded
(because the sustain pedal releases a voice that has been stolen and
repurposed for a new note while the pedal was held down). But it
works with PD Vanilla and is reasonably fast. NOTE: The voice patch
has been designed to ignore MIDI note number 0 \, because when the
sustain pedal is released we don't know the MIDI note number anymore.
Otherwise we could encode the MIDI note number in the saved value e.g.
with the formula (voice number + midi note * 1000) and then restore
it when the sustain pedal is released. Unfortunately \, retriggering
and sustenuto are not that easy to implement.;
#X obj 650 420 loadbang;
#X msg 650 449 0;
#X obj 1040 390 < 0.0001;
#X obj 1050 540 trigger b b;
#X msg 1110 570 0;
#X text 1170 570 (1 = put voice number in bag \, 0 = release voices)
;
#X connect 1 0 7 0;
#X connect 1 1 7 1;
#X connect 2 0 15 0;
#X connect 3 0 16 0;
#X connect 4 0 17 0;
#X connect 6 0 8 0;
#X connect 7 0 2 0;
#X connect 7 1 3 0;
#X connect 7 2 4 0;
#X connect 8 0 9 0;
#X connect 9 0 5 0;
#X connect 9 0 5 1;
#X connect 10 0 11 0;
#X connect 11 0 21 0;
#X connect 13 0 31 0;
#X connect 14 0 13 0;
#X connect 19 0 43 0;
#X connect 20 0 14 0;
#X connect 21 0 44 0;
#X connect 21 1 13 1;
#X connect 22 0 13 0;
#X connect 25 0 26 0;
#X connect 26 0 32 0;
#X connect 27 0 6 0;
#X connect 28 0 27 0;
#X connect 29 0 6 1;
#X connect 30 0 6 2;
#X connect 31 0 8 0;
#X connect 32 0 27 1;
#X connect 33 0 32 1;
#X connect 34 0 33 0;
#X connect 41 0 42 0;
#X connect 42 0 33 0;
#X connect 43 0 14 1;
#X connect 44 0 22 0;
#X connect 44 1 45 0;
#X connect 45 0 13 1;
