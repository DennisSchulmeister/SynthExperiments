#N canvas 0 49 1920 1009 12;
#X obj -30 -30 preset_hub k12 1 %hidden%;
#N canvas 0 49 1920 1009 ui 0;
#X obj 190 90 cnv 15 960 530 empty empty empty 20 12 0 14 #e0eaf1 #404040
0;
#X obj 500 130 cnv 15 640 370 empty empty empty 20 12 0 14 #ffffff
#404040 0;
#N canvas 0 0 450 300 (subpatch) 0;
#X array soundfile 51316 float 0 black black;
#X coords 0 1 51315 -1 640 370 1;
#X restore 500 130 graph;
#X obj 200 100 bng 20 250 50 0 cmd-load-soundfile empty Load\ Soundfile
25 7 0 13 #fcfcfc #000000 #000000 1;
#X obj 200 260 bng 20 250 50 0 cmd-clear-all empty Clear\ All 25 7
0 13 #fcfcfc #000000 #000000 1;
#X obj 200 180 bng 20 250 50 0 cmd-analyze empty Anaylze 25 7 0 13
#fcfcfc #000000 #000000 1;
#X floatatom 360 340 5 0 0 1 ms - p-resynth-size-ms 0 0 1, f 5;
#X floatatom 1050 100 10 0 0 1 Hz - p-resyth-base-frequency 0 0 0,
f 10;
#N canvas 0 49 1920 1009 cmd-others 0;
#X text 10 10 Handle other commands;
#X obj 100 130 r cmd-load-soundfile;
#X text 100 100 ==== Load Soundfile ====;
#X obj 100 160 openpanel 0;
#X msg 100 190 read -resize \$1 soundfile;
#X obj 100 220 soundfiler;
#X text 400 100 ==== Play Soundfile ====;
#X obj 400 130 r cmd-play-soundfile;
#X obj 400 200 tabplay~ soundfile;
#X obj 400 230 throw~ output;
#X obj 900 150 savepanel;
#X msg 900 180 write \$1;
#X obj 1200 150 openpanel;
#X obj 900 210 s resynth-global;
#X msg 600 160 stop;
#X text 600 100 ==== Stop Playback ====;
#X obj 600 130 r cmd-stop-soundfile;
#X obj 140 280 samplerate~;
#X obj 100 340 s i-resynth-length-seconds;
#X obj 100 310 /;
#X obj 100 250 trigger f b;
#X text 900 90 ==== Save Analysis ====;
#X obj 900 120 r cmd-save-analysis;
#X text 1200 90 ==== Load Analysis ====;
#X obj 1200 120 r cmd-load-analysis;
#X msg 1200 180 \; cmd-clear-analysis bang \; resynth-global read \$1
\; resynth-global initialize;
#X connect 1 0 3 0;
#X connect 3 0 4 0;
#X connect 4 0 5 0;
#X connect 5 0 20 0;
#X connect 7 0 8 0;
#X connect 8 0 9 0;
#X connect 10 0 11 0;
#X connect 11 0 13 0;
#X connect 12 0 25 0;
#X connect 14 0 8 0;
#X connect 16 0 14 0;
#X connect 17 0 19 1;
#X connect 19 0 18 0;
#X connect 20 0 19 0;
#X connect 20 1 17 0;
#X connect 22 0 10 0;
#X connect 24 0 12 0;
#X restore 1400 260 pd cmd-others;
#N canvas 0 49 1920 1009 cmd-analyze 0;
#X text 10 10 Do the frequency analysis;
#X obj 100 100 r cmd-analyze;
#X obj 100 150 trigger b b;
#N canvas 0 49 1920 1009 detect-pitch 0;
#X text 10 10 Detect fundamental pitch;
#X obj 100 100 inlet;
#X obj 100 350 outlet;
#X obj 140 180 samplerate~;
#X obj 140 240 sigmund~ -t pitch;
#X msg 140 210 list soundfile 128 0 \$1 0;
#X obj 140 270 mtof;
#X obj 100 150 trigger b b;
#X obj 140 300 s i-resynth-base-frequency;
#X connect 1 0 7 0;
#X connect 3 0 5 0;
#X connect 4 0 6 0;
#X connect 5 0 4 0;
#X connect 6 0 8 0;
#X connect 7 0 2 0;
#X connect 7 1 3 0;
#X restore 100 250 pd detect-pitch;
#N canvas 0 49 1920 1009 write-header 0;
#X text 10 10 Write initialization header with global fields;
#X obj 100 100 inlet;
#X obj 100 1130 outlet;
#X msg 140 210 \; resynth-global add init length-seconds \$1;
#X obj 100 150 trigger b b;
#X obj 100 260 trigger b b;
#X obj 100 370 trigger b b;
#X obj 100 480 trigger b b;
#X obj 100 590 trigger b b;
#X obj 100 700 trigger b b;
#X obj 100 810 trigger b b;
#X obj 100 1030 trigger b b;
#X msg 140 1060 \; resynth-global add wait;
#X msg 140 320 \; resynth-global add init length-frames \$1;
#X msg 140 430 \; resynth-global add init frequency \$1;
#X msg 140 540 \; resynth-global add init frame-ms \$1;
#X msg 140 650 \; resynth-global add init speed \$1;
#X obj 140 180 value seconds;
#X obj 140 290 value frames;
#X obj 140 400 value frequency;
#X obj 140 510 value frame_ms;
#X obj 140 620 value speed;
#X obj 140 730 value loop_start_frame;
#X msg 140 760 \; resynth-global add init loop-start-frame \$1;
#X msg 140 870 \; resynth-global add init loop-end-frame \$1;
#X obj 140 840 value loop_end_frame;
#X obj 100 920 trigger b b;
#X obj 140 950 value release_frame;
#X msg 140 980 \; resynth-global add init release-frame \$1;
#X connect 1 0 4 0;
#X connect 4 0 5 0;
#X connect 4 1 17 0;
#X connect 5 0 6 0;
#X connect 5 1 18 0;
#X connect 6 0 7 0;
#X connect 6 1 19 0;
#X connect 7 0 8 0;
#X connect 7 1 20 0;
#X connect 8 0 9 0;
#X connect 8 1 21 0;
#X connect 9 0 10 0;
#X connect 9 1 22 0;
#X connect 10 0 26 0;
#X connect 10 1 25 0;
#X connect 11 0 2 0;
#X connect 11 1 12 0;
#X connect 17 0 3 0;
#X connect 18 0 13 0;
#X connect 19 0 14 0;
#X connect 20 0 15 0;
#X connect 21 0 16 0;
#X connect 22 0 23 0;
#X connect 25 0 24 0;
#X connect 26 0 11 0;
#X connect 26 1 27 0;
#X connect 27 0 28 0;
#X restore 100 310 pd write-header;
#N canvas 0 49 1920 1009 generate-frames 0;
#X text 10 10 Generate frames with harmonic coefficients;
#X obj 100 100 inlet;
#X obj 100 2100 outlet;
#X obj 190 1330 sigmund~ -t -npeak 16 peaks;
#N canvas 0 0 450 300 (subpatch) 0;
#X array analysis_frame 1 float 1 black black;
#A 0 -3.05176e-05;
#X coords 0 1 1 -1 400 200 1;
#X restore 800 100 graph;
#X obj 130 530 ./utils/for-loop;
#X obj 340 590 print Analyzing frame;
#X obj 130 500 pack f f;
#X text 170 640 ---- Copy samples for current frame into buffer ----
;
#X obj 190 830 ./utils/for-loop;
#X obj 190 800 pack f f;
#X msg 190 770 0;
#X obj 130 200 samplerate~;
#X obj 130 290 value frame_samples;
#X obj 100 170 trigger b b;
#X text 110 390 ---- Analyze individual frames ----;
#X obj 240 770 value frame_samples;
#X obj 220 920 + 1;
#X obj 220 950 tabread soundfile;
#X obj 220 890 float;
#X obj 220 860 bang;
#X obj 100 410 trigger b b;
#X obj 130 440 trigger b b b, f 61;
#X msg 550 860 -1;
#X text 260 530 (for each frame);
#X text 320 830 (for each sample);
#X text 590 860 (read soundfile from beginning);
#X obj 220 980 trigger f b;
#X obj 360 1020 float;
#X obj 360 1050 + 1;
#X msg 470 990 -1;
#X text 510 991 (write buffer from beginning);
#X obj 160 660 trigger b b;
#X obj 190 1270 samplerate~;
#X obj 220 1080 tabwrite analysis_frame;
#X msg 220 720 \; analysis_frame const 0;
#X msg 190 1300 list analysis_frame 128 0 \$1 0;
#X obj 130 230 expr max($f1 / 1000 * frame_ms \, 128);
#X text 400 230 <--- sigmund~ needs at least 128 samples!;
#X obj 190 690 trigger b b b b, f 41;
#X obj 190 1360 unpack f f f;
#X text 400 1330 Harmonic Nr. \, Frequency \, Amplitude \, Cosine \,
Sine;
#X text 170 1130 ---- Find harmonics in current frame ----;
#X text 170 1470 ---- Sort by frequency instead of amplitude ----;
#X obj 190 1550 text define analysis_harmonics;
#X msg 190 1520 sort;
#X msg 190 1181 -1;
#X obj 190 1210 text delete analysis_harmonics;
#X obj 190 1420 text insert analysis_harmonics 1e+09;
#X obj 190 1390 pack f f;
#X obj 160 1150 trigger b b;
#X obj 160 1240 trigger b b;
#X obj 160 1490 trigger b b;
#X text 170 1600 ---- Write harmonic coefficients ---;
#X obj 200 1790 text sequence analysis_harmonics;
#X msg 160 2030 \; resynth-global add wait;
#X obj 160 1620 trigger b b;
#X obj 190 1650 value frame_number;
#X msg 190 1680 \; resynth-global add frame \$1;
#X obj 200 590 value frame_number;
#X obj 160 560 trigger b f f;
#X obj 200 1890 float;
#X obj 200 1920 + 1;
#X msg 450 1860 0;
#X obj 200 1820 trigger b a, f 16;
#X obj 200 1950 list append, f 16;
#X obj 160 1730 trigger b b b, f 42;
#X text 490 1860 (reset harmonic number);
#X msg 200 1760 line 0 \, auto;
#X msg 200 1980 \; resynth-global add harmonic \$1 \$2 \$3;
#X msg 130 470 0;
#X obj 170 470 expr ceil(frames) - 1;
#X obj 130 260 trigger f f;
#X msg 280 290 \; analysis_frame resize \$1;
#X text 110 150 ---- Reset internal buffer ----;
#X connect 1 0 14 0;
#X connect 3 0 40 0;
#X connect 5 0 60 0;
#X connect 7 0 5 0;
#X connect 9 0 20 0;
#X connect 10 0 9 0;
#X connect 11 0 10 0;
#X connect 12 0 37 0;
#X connect 14 0 21 0;
#X connect 14 1 12 0;
#X connect 16 0 10 1;
#X connect 17 0 19 1;
#X connect 17 0 18 0;
#X connect 18 0 27 0;
#X connect 19 0 17 0;
#X connect 20 0 19 0;
#X connect 21 0 2 0;
#X connect 21 1 22 0;
#X connect 22 0 70 0;
#X connect 22 1 71 0;
#X connect 22 2 23 0;
#X connect 23 0 19 1;
#X connect 27 0 34 0;
#X connect 27 1 28 0;
#X connect 28 0 29 0;
#X connect 29 0 28 1;
#X connect 29 0 34 1;
#X connect 30 0 28 1;
#X connect 32 0 50 0;
#X connect 32 1 39 0;
#X connect 33 0 36 0;
#X connect 36 0 3 0;
#X connect 37 0 72 0;
#X connect 39 0 11 0;
#X connect 39 1 35 0;
#X connect 39 2 16 0;
#X connect 39 3 30 0;
#X connect 40 1 49 0;
#X connect 40 2 49 1;
#X connect 45 0 44 0;
#X connect 46 0 47 0;
#X connect 49 0 48 0;
#X connect 50 0 51 0;
#X connect 50 1 46 0;
#X connect 51 0 52 0;
#X connect 51 1 33 0;
#X connect 52 0 56 0;
#X connect 52 1 45 0;
#X connect 54 0 64 0;
#X connect 56 0 66 0;
#X connect 56 1 57 0;
#X connect 57 0 58 0;
#X connect 60 0 32 0;
#X connect 60 1 59 0;
#X connect 60 2 6 0;
#X connect 61 0 62 0;
#X connect 62 0 61 1;
#X connect 62 0 65 0;
#X connect 63 0 61 1;
#X connect 64 0 61 0;
#X connect 64 1 65 1;
#X connect 65 0 69 0;
#X connect 66 0 55 0;
#X connect 66 1 68 0;
#X connect 66 2 63 0;
#X connect 68 0 54 0;
#X connect 70 0 7 0;
#X connect 71 0 7 1;
#X connect 72 0 13 0;
#X connect 72 1 73 0;
#X restore 100 340 pd generate-frames;
#N canvas 0 49 1920 1009 calc-frame-count 0;
#X obj 100 100 inlet;
#X text 10 10 Calculate the number of frames;
#X obj 100 220 outlet;
#X obj 110 191 s i-resynth-length-frames;
#X obj 100 130 trigger b b;
#X obj 110 160 expr seconds * 1000 / frame_ms;
#X connect 0 0 4 0;
#X connect 4 0 2 0;
#X connect 4 1 5 0;
#X connect 5 0 3 0;
#X restore 100 280 pd calc-frame-count;
#X msg 140 180 \; cmd-clear-analysis-result bang;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 2 1 7 0;
#X connect 3 0 6 0;
#X connect 4 0 5 0;
#X connect 6 0 4 0;
#X restore 1400 230 pd cmd-analyze;
#X obj 200 200 bng 20 250 50 0 cmd-save-analysis empty Save\ Analysis
25 7 0 13 #fcfcfc #000000 #000000 1;
#X obj 200 220 bng 20 250 50 0 cmd-load-analysis empty Load\ Analysis
25 7 0 13 #fcfcfc #000000 #000000 1;
#X msg 10 280 set \$1;
#X obj 1400 110 loadbang;
#X obj 200 120 bng 20 250 50 0 cmd-play-soundfile empty Play\ Soundfile
25 7 0 13 #fcfcfc #000000 #000000 1;
#X obj 1400 610 dac~;
#X msg 1010 40 set \$1;
#X text 200 510 Speed:;
#X floatatom 250 510 5 0 0 2 - - p-resynth-speed 0 0 1, f 5;
#X msg 10 450 set \$1;
#X obj 10 420 r p-resynth-speed;
#X obj 10 250 r p-resynth-frame-ms;
#N canvas 0 49 1920 1009 cmd-clear 0;
#X obj 700 100 r clear-soundfile;
#X text 100 70 ==== Clear Data ====;
#X obj 540 100 r cmd-clear-all;
#X msg 700 130 \; soundfile const 0 \; soundfile resize 100 \; i-resynth-length-seconds
0 \;;
#X obj 100 100 r cmd-clear-analysis-result;
#X obj 340 100 r cmd-clear-analysis;
#X msg 100 140 \; resynth-global clear \; i-resynth-base-frequency
0 \; i-resynth-length-frames 0;
#X msg 340 140 \; p-resynth-frame-ms 50 \; p-resynth-speed 1 \; p-resynth-loop-start-frame
0 \; p-resynth-loop-end-frame 0 \; p-resynth-release-frame 0 \;;
#X connect 0 0 3 0;
#X connect 2 0 3 0;
#X connect 2 0 7 0;
#X connect 2 0 6 0;
#X connect 4 0 6 0;
#X connect 5 0 6 0;
#X connect 5 0 7 0;
#X restore 1400 200 pd cmd-clear;
#N canvas 0 49 1920 1009 resynth-global 0;
#X text 10 10 Global buffer for the resynthesis sequencer. This one
writes the result files and sets the global parameters. The other ones
control their respective oscillator.;
#X obj 100 100 r resynth-global;
#X msg 100 220 clear;
#X text 400 100 <--- Control commands;
#X msg 300 220 read -c \$1;
#X msg 390 220 write -c \$1;
#X obj 100 270 text define resynthesis;
#X text 100 290 Sequenca data (click to edit);
#X obj 800 200 trigger b b;
#X msg 820 230 line 0;
#X text 110 200 (clear sequence);
#X text 400 200 (load and save file);
#X text 570 180 (add line);
#X text 800 180 (initialize global parameters);
#X obj 800 530 s i-resynth-length-seconds;
#X obj 830 500 s i-resynth-length-frames;
#X obj 870 470 s i-resynth-base-frequency;
#X obj 900 440 s p-resynth-frame-ms;
#X obj 960 410 s p-resynth-speed;
#X obj 1060 380 s p-resynth-loop-start;
#X obj 1210 350 s p-resynth-loop-end;
#X obj 800 290 route init;
#X obj 800 260 text sequence resynthesis -w wait;
#X obj 100 130 route clear read write add initialize;
#X obj 570 200 list;
#X obj 570 230 text insert resynthesis 1e+09;
#X obj 800 320 route seconds frames frequency frame-ms speed loop-start-frame
loop-end-frame release-frame, f 94;
#X obj 1380 350 s p-resynth-release-frame;
#X connect 1 0 23 0;
#X connect 2 0 6 0;
#X connect 4 0 6 0;
#X connect 5 0 6 0;
#X connect 8 0 22 0;
#X connect 8 1 9 0;
#X connect 9 0 22 0;
#X connect 21 0 26 0;
#X connect 22 0 21 0;
#X connect 23 0 2 0;
#X connect 23 1 4 0;
#X connect 23 2 5 0;
#X connect 23 3 24 0;
#X connect 23 4 8 0;
#X connect 24 0 25 0;
#X connect 26 0 14 0;
#X connect 26 1 15 0;
#X connect 26 2 16 0;
#X connect 26 3 17 0;
#X connect 26 4 18 0;
#X connect 26 5 19 0;
#X connect 26 6 20 0;
#X connect 26 7 27 0;
#X restore 1400 290 pd resynth-global;
#X obj 1400 490 mtof;
#X obj 1550 490 / 127;
#X floatatom 1400 520 6 0 0 1 Frequency - - 0 0 1, f 6;
#X floatatom 1550 519 6 0 0 1 Velocity - - 0 0 1, f 6;
#X floatatom 1400 460 5 0 0 0 - - - 0 0 1, f 5;
#X obj 1400 430 notein 1;
#X obj 1400 550 ./utils/poly-sustain 8 1;
#X obj 1700 462 ctlin 64 1;
#X obj 1400 580 clone oscillator 8;
#X text 1400 400 ==== Mini Synthesizer for preview playing ====;
#X text 1400 80 ==== GUI Handling ====;
#X obj 1700 491 / 127;
#X floatatom 1700 520 5 0 0 1 Sustain - - 0 0 1, f 5;
#X floatatom 450 530 5 0 0 2 - - p-resynth-loop-start-frame 0 0 1,
f 5;
#X floatatom 450 560 5 0 0 2 - - p-resynth-loop-end-frame 0 0 1, f
5;
#X text 630 100 Length:;
#X floatatom 690 100 10 0 0 1 Seconds - - 0 0 0, f 10;
#X floatatom 830 100 5 0 0 1 Frames - - 0 0 0, f 5;
#X msg -50 550 set \$1;
#X msg -50 630 set \$1;
#X obj 1010 10 r i-resynth-base-frequency;
#X msg 580 40 set \$1;
#X obj 580 10 r i-resynth-length-seconds;
#X msg 790 40 set \$1;
#X obj 790 -20 r i-resynth-length-frames;
#X obj 200 320 cnv 15 1 1 empty empty Analysis\ Parameters 0 0 0 14
#e0e0e0 #780a0a 0;
#X obj 200 490 cnv 15 1 1 empty empty Playback\ Parameters 0 0 0 14
#e0e0e0 #780a0a 0;
#X obj 500 100 cnv 15 1 1 empty empty Information 0 7 0 14 #e0e0e0
#780a0a 0;
#X text 940 100 Base frequency:;
#X obj 1560 580 catch~ output;
#X text 200 340 Snapshot Frame Size:;
#X obj 1400 139 s cmd-clear-all;
#X obj 200 140 bng 20 250 50 0 cmd-stop-soundfile empty Stop\ Playback
25 7 0 13 #fcfcfc #000000 #000000 1;
#X obj 640 40 value seconds;
#X obj 900 10 value frames;
#X obj 1070 40 value frequency;
#X obj 70 450 value speed;
#X obj 70 280 value frame_ms;
#X text 200 380 The analysis will detect the frequency and amplitude
of 16 harmonics for every frame. You can preview the resynthesized
sound via MIDI and load the anaylsis result into Mini Clavier., f
40;
#X floatatom 450 590 5 0 0 0 - - p-resynth-release-frame 0 0 1, f
5;
#X text 360 530 Loop Start:;
#X text 360 560 Loop End:;
#X text 360 590 Release:;
#X msg -50 710 set \$1;
#X obj -50 680 r p-resynth-release-frame;
#X obj -50 520 r p-resynth-loop-start-frame;
#X obj -50 600 r p-resynth-loop-end-frame;
#X obj 10 550 value loop_start_frame;
#X obj 10 630 value loop_end_frame;
#X obj 10 710 value release_frame;
#X obj 190 680 r i-resynth-length-frames;
#X msg 190 710 range 0 \$1;
#X text 500 770 ==== Show frames in graph ====;
#X obj 500 860 samplerate~;
#X obj 500 800 r p-resynth-frame-ms;
#X obj 500 890 expr \\$f1 / 1000 * \\$f2;
#X obj 500 830 trigger b f;
#X msg 500 924 \; soundfile xticks 0 \$1 1;
#X obj 790 10 expr ceil($f1);
#X connect 12 0 6 0;
#X connect 13 0 55 0;
#X connect 16 0 7 0;
#X connect 19 0 18 0;
#X connect 20 0 19 0;
#X connect 20 0 60 0;
#X connect 21 0 12 0;
#X connect 21 0 61 0;
#X connect 24 0 26 0;
#X connect 25 0 27 0;
#X connect 26 0 30 0;
#X connect 27 0 30 1;
#X connect 28 0 24 0;
#X connect 29 0 28 0;
#X connect 29 1 25 0;
#X connect 30 0 32 0;
#X connect 31 0 35 0;
#X connect 32 0 15 0;
#X connect 32 0 15 1;
#X connect 35 0 36 0;
#X connect 36 0 30 2;
#X connect 42 0 37 0;
#X connect 43 0 38 0;
#X connect 44 0 16 0;
#X connect 44 0 59 0;
#X connect 45 0 40 0;
#X connect 46 0 45 0;
#X connect 46 0 57 0;
#X connect 47 0 41 0;
#X connect 48 0 58 0;
#X connect 48 0 82 0;
#X connect 53 0 15 0;
#X connect 53 0 15 1;
#X connect 67 0 63 0;
#X connect 68 0 67 0;
#X connect 68 0 73 0;
#X connect 69 0 42 0;
#X connect 69 0 71 0;
#X connect 70 0 43 0;
#X connect 70 0 72 0;
#X connect 74 0 75 0;
#X connect 77 0 79 0;
#X connect 78 0 80 0;
#X connect 79 0 81 0;
#X connect 80 0 77 0;
#X connect 80 1 79 1;
#X connect 82 0 47 0;
#X coords 0 -1 1 1 960 530 2 190 90;
#X restore 100 100 pd ui;
#N canvas 0 49 1920 1009 title 0;
#X obj 200 100 cnv 15 960 30 empty empty Harmonic\ Reynthesis\ for\ Mini\ Clavier
12 12 0 14 #842a2a #ffffff 0;
#X coords 0 -1 1 1 960 30 2 200 100;
#X restore 100 70 pd title;
